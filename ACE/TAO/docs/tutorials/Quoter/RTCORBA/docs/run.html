<!-- $Id$ -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Execution programs for the Stock Quoter Publisher/Subscriber Real-time CORBA Service</title>
</head>

<body
 text = "#000000"
 link = "#000fff"
 vLink= "#ff0f0f"
 aLink = "#0000ff"
 bgColor = "#ffffff">

<hr><h2>Execution programs for the Stock Quoter Publisher/Subscriber Real-time CORBA Service</h2><hr>

<P> There are three execution programs (*.cpp files that have the main () functions) in this system:
Distributor, Broker and Admin. Each of them belongs to the corresponding project defined in the
StockQuoter.mpc file. <P>

<h3>Building the Distributor program</h3>

The Distributor.cpp file is used for this purpose. It contains the main () function and is used to generated the
Distributor execution file. The main steps in this file are described as follows: <P>

<li>Initalize the ORB.</li> <P>

<li>Get the RootPOA.</li> <P>

<li>Activate the POAManager.</li> <P>

<li>Create a Distributor factory object, which will then create a Distributor object.</li>
<PRE>
    Stock_StockDistributorHome_i stock_distributor_home (orb);
    Stock::StockDistributor_var stock_distributor = stock_distributor_home.create ();
</PRE>

<li>Write the object reference for the Distributor object to a file so other projects
can read it when they are bootstrapping.</li> <P>

<li>Set the rate of the Distributor object.</li> <P>

<li>Enter into the event looping.</li> <P>

<hr><h3>Building the Broker program</h3>

The Broker.cpp file is used for this purpose. It contains the main () function and is used to generated the
Broker execution file. The main steps in this file are described as follows: <P>

<li>Initalize the ORB.</li> <P>

<li>Get the RootPOA.</li> <P>

<li>Activate the POAManager.</li> <P>

<li>Extract the command-line arguments, which give the stock name and the priority of the Broker objec
(actually, the priority of the StockNameConsumer object that the Broker object contains).</li> <P>

<li>Create a Broker factory object, which will then create a Broker object.</li>
<PRE>
    Stock_StockBrokerHome_i stock_broker_home (orb, stock_name, priority);
    Stock::StockBroker_var stock_broker = stock_broker_home.create ();
</PRE>

<li>Read and destringify the Distributor object's IOR and narrow it to a Distributor object reference.</li> <P>

<li>Connect the Quoter object to the Broker object.</li>
<PRE>
    Stock::StockQuoter_var stock_quoter = stock_distributor->provide_quoter_info ();
    stock_broker->connect_quoter_info (stock_quoter);
</PRE>

<li>Create a new consumer; initialize it; subscribe it to the notification service.</li>
<PRE>
    Stock::StockNameConsumer_var consumer = stock_broker->get_consumer_notifier ();
    Stock::Cookie *cookie = stock_distributor->subscribe_notifier (consumer, priority);
</PRE>

<li>Enter into the event looping.</li> <P>

<hr><h3>Building the Admin program</h3>

The Admin.cpp file is used for this purpose. It contains the main () function and is used to generated
Admin execution file. The main steps in this file are described as follows: <P>

<li>Initalize the ORB.</li> <P>

<li>Read and destringify the Distributor object's IOR and narrow it to a Distributor object reference.</li> <P>

<li>Call the operations of StockDistributor interface:</li>
<PRE>
    start: Start the distributor.
    stop: Stop the distributor.
    rate: Change the notification rate of the distributor.
</PRE>

<hr><h3>Running the Stock Quoter Service</h3>

When executing the programs, they should be executed in the following order:

<PRE>
    Distributor
    Broker
    Admin
</PRE>

You can run more than one Broker program at the same time. Each of them should be given different stock name
that it is interested in. All the stock information is installed in the <A HREF="database.html">Stock Database</A>.
The number of stocks can easily be extended by adding items to the stock_names array of 
the Stock Database constuctor. <P>

<hr><b>Email: </b><a href="mailto:"</a<ADDRESS>shanshan.jiang@vanderbilt.edu</ADDRESS>

</body>

</html>

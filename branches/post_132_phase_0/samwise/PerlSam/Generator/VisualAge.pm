# $Id$

package PerlSam::Generator::VisualAge;

use Cwd;
use Data::Dumper;
use File::Basename;
use FileHandle;
use strict;

###############################################################################
# Forward Declarations


###############################################################################
# Constructor

sub new (@)
{
    my $proto = shift;
    my $class = ref ($proto) || $proto;
    my $self = {};

    bless ($self, $class);
    return $self;
}

###############################################################################
# Methods

sub GenerateWorkspace (\%)
{
    my $self = shift;
    my $data = shift;

    my $string;

    $string .= "//\n";
    $string .= "//\n";
    $string .= "// \$Id\$\n";
    $string .= "//\n";
    $string .= "// Visual Age C++ 5 super-project generated by the Samwise Compiler\n";
    $string .= "//\n";
    $string .= "//\n";
    $string .= "\n";

    foreach my $project (PerlSam::Generator::ProjectOrder (%{$data})) {
        $string .= "subproject $project, icc \"".$project.".icc\", ics \"".$project.".ics\"\n";
        $string .= "{\n";
        $string .= "}\n";
        $string .= "\n";
    }

    $string .= "build all\n";
    $string .= "{\n";
    foreach my $project (PerlSam::Generator::ProjectOrder (%{$data})) {
        $string .= "use $project\n";
    }
    $string .= "}\n";

    my $file_name;

    if (defined $data->{WORKSPACE}->{NAME}) {
        $file_name = $data->{WORKSPACE}->{NAME};
    }
    else {
        $file_name = getcwd ();

        if ($file_name =~ m/\/([^\/]*)$/) {
            $file_name = $1;
        }
    }

    $file_name = $file_name . ".icp";

    print "Creating Workspace: $file_name\n";

    my $file_handle = new FileHandle ($file_name, "w");
    binmode $file_handle;
    $string =~ s/\n/\r\n/g;
    print $file_handle $string;
}

sub GenerateProjects (\%)
{
    my $self = shift;
    my $data = shift;

    foreach my $project (sort keys %{$data->{PROJECTS}}) {
        my $string;
        my $description = $data->{PROJECTS}->{$project}->{DESCRIPTION};
        my $target = $data->{PROJECTS}->{$project}->{TARGET};
        my $type = $data->{PROJECTS}->{$project}->{TYPE};

        my $file_name = $project . ".icc";

        my $string;
        $string .= "//\n";
        $string .= "// Visual Age C++ 5 Project file generated by the Samwise Compiler\n";
        $string .= "//\n";

        my $ace_root = PerlSam::Generator::ConvertPathToRelative ("/");

        $string .= "include \"".$ace_root."samwise/makeinclude/vacpp_setup.icc\"\n";
        $string .= "option\n";
        $string .= "    link(libSearchPath,),\n";

        print "Creating Project: $file_name\n";

        # my $file_handle = new FileHandle ($file_name, "w");
        # print $file_handle $string;
    }
}

###############################################################################
# Internal Methods

1;

#!/bin/sh

# $Id$

# Author:  Ossama Othman <othman@cs.wustl.edu>

# This script generates an HTML windex file from a given list of man pages.
# It is meant to be a replacement for platforms that do not have a
# "catman -w" equivalent command.  No intermediate windex file is necessary.

# SED ans AWK expressions derived from man2html related scripts in the
# same directory this script is found in.

set -e

HTML_WINDEX="acewindex.html"

echo Generating ACE HTML manual page index: $HTML_WINDEX.

rm -f $HTML_WINDEX

cat > $HTML_WINDEX <<EOF
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>ACE Manual Page Index</title>
  </head>

  <body text = "#000000" link="#000fff" vlink="#ff0f0f" bgcolor="#ffffff">
    <center><h1>ACE Manual Page Index</h1></center>

 <p>

 This file has been generated from the <A
 HREF="http://www.cs.wustl.edu/~schmidt/ACE_wrappers/man/man3/">manual pages</A>
 in the <A
 HREF="http://www.cs.wustl.edu/~schmidt/ACE.html">ACE</A> package and
 it contains a list of pointers to the manual pages generated by the
 <A HREF="http://www.cs.wustl.edu/~schmidt/ACE_wrappers/bin/README.html">OSE
 documentation tools</A>.

 <p>
 <HR>
 <UL>
EOF

for p in $@; do
  file=`basename $p`
  man_page=`echo $file | sed -e 's/\.[0-9]$//'`
  entry=`echo $file | sed -e 's/\./ /' -e 's/[0-9]$/(\0)/'`
  description=`cat $p | awk '/^.SH.*NAME.*$/ {getline;while ( $0 !~ /\.[a-zA-Z]+.*/ ) {getline; if ($0 !~  /\.[a-zA-Z]+.*/ ) print}}' | \
        sed  -e 's/\\-/-/g' \
             -e 's/\\ / /g' \
             -e 's/\\\//g' \
             -e 's/\\[0&]/  /g' \
             -e 's/&/\&amp;/g' \
             -e 's/</\&lt;/g' \
             -e 's/>/\&gt;/g' \
             -e 's/\\|//g' \
             -e 's^\\fB\([^\\]*\)\\fR^<B>\1</B></I>^g' \
             -e 's^\\f(CO\(.[^\\]*\)\\fR^<CODE>\1</CODE>^g' \
             -e 's^\\fI\(.[^\\]*\)\\fR^<I>\1</I></B>^g' \
             -e 's^\\fB^<B>^g' \
             -e 's^\\f(CO^<CODE>^g' \
             -e 's^\\fI^<I>^g' \
             -e 's^\\f[RP]^</B></I></CODE>^g' \
             -e 's/^\.RS.*/<UL>/' \
             -e 's$^\.RE.*$</UL>$' \
             -e '/^\.[a-zA-Z]*.*/d'`

  echo "<li><a HREF =\"html/$man_page.html\">$entry</a> $description</li>" >> $HTML_WINDEX

done

cat >> $HTML_WINDEX <<EOF
</UL>

    <hr>
EOF

echo Last modified: `date` >> $HTML_WINDEX

cat >> $HTML_WINDEX <<EOF
  </body>
</html>
EOF

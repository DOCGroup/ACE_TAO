Sun Jan 12 16:59:52 1997  Douglas C. Schmidt  <schmidt@flamenco.cs.wustl.edu>

	* ace/Timer_List.cpp (schedule): Cleanup the code so that (1)
 	  timer_id never == -1 (in order to distinguish it from error
 	  return values and (2) so that we avoid an unnecessary check for
 	  operator new failure.

	* ace/OS.h: Added a new #define called ACE_DEFAULT_MAX_TIMERS,
 	  which specifies the maximum number of ACE_Event_Handlers
 	  supported by ACE_Timer_Heap.

	* ace/Proactor.cpp (ACE_Proactor): Updated the allocation of
 	  ACE_Timer_Queue so that it really points to an ACE_Timer_List by
 	  default.  Naturally, this can be overridden by users.

	* ace/ReactorEx.cpp (open): Updated the allocation of
 	  ACE_Timer_Queue so that it really points to an ACE_Timer_List by
 	  default.  Naturally, this can be overridden by users.

	* ace/Reactor.cpp (open): Updated the allocation of
 	  ACE_Timer_Queue so that it really points to an ACE_Timer_List by
 	  default.  Naturally, this can be overridden by users.

	* ace: Added two new classes called ACE_Timer_List and
 	  ACE_Timer_Heap, which derive from ACE_Timer_Queue.
  	  ACE_Timer_List is essentially the old behavior of
 	  ACE_Timer_Queue, i.e., it uses an implementation of a linked
 	  list of ACE_Timer_Nodes.  ACE_Timer_Heap, on the other hand,
 	  uses a heap-based callout queue, which is more appropriate for
 	  certain real-time applications.

	* ace/Timer_Queue: Revised the ACE_Timer_Queue implementation so
 	  that it's now an abstract base class with most of the
 	  implementation details pushed into the ACE_Timer_List and
 	  ACE_Timer_Heap subclasses.

	* ace/Timer_Queue.h: Made all the ACE_Timer_Queue methods public
 	  so that we can override them in a subclass (e.g., the new
 	  ACE_Timer_Heap).

	* examples/Logger/Acceptor-server/server_loggerd.cpp: Fixed this
 	  example application so that it only uses a single Reactor (the
 	  REACTOR::instance()) rather than two Reactors.  Thanks to Sandro
 	  Doro <alex@aureus.sublink.org> for reporting this.

	* netsvcs/lib/Logging_Strategy.cpp: Fixed the #include of
 	  fstream.h and iostream.h to use the '<' '>' notation rather than
 	  the '"' and '"' notation.  This avoids problems with running
 	  "make depend".  Thanks to Rino Simioni <sir@necsy.it> for
 	  reporting this fix.

Sun Jan 12 18:20:49 1997  David L. Levine  <levine@cs.wustl.edu>

	* ace/ACE.cpp (round_to_pagesize): fixed typo in reference to
	  ACE::pagesize_.

	* ace/ACE.cpp: initialize ACE::pagesize_ to 0.

	* ace/config-irix*.h and config-win*.h: removed ACE_PAGE_SIZE
	  definition because these platforms no longer use it

	* tests/UNIX*.conf and Win32server.config:  replace net_svcs
	  with netsvcs

Sat Jan 11 15:11:28 1997  Douglas C. Schmidt  <schmidt@flamenco.cs.wustl.edu>

	* ace/OS.i (thr_setprio): The POSIX implementation of
 	  ACE_OS:thr_setprio did not set the priority.  It calls:

	  pthread_setschedparam( thr_id, &policy, &param )
 
          and then does
 
          prio = param.sched_priority.
 
          instead of

	  param.sched_priority = prio;
	  
	  This is now fixed.  Thanks to John Bossom <John.Bossom@Cognos.COM>
	  for reporting this.

	* ace/config-irix*.h: Modified all the IRIX config files to
	  use the new ACE_HAS_GETPAGESIZE feature since this is necessary 
	  to differentiate between IRIX and IRIX64.
	  Thanks to Fred LaBar <flabar@fallschurch.esys.com> for
	  reporting this.

	* ace/ACE.cpp: Modified the round_to_pagesize() so that if
	  a config.h file enables ACE_HAS_GETPAGESIZE then we use
	  that function in preference to the value in config.h.
	  Thanks to Fred LaBar <flabar@fallschurch.esys.com> for
	  suggesting this.

	* ace/ACE.cpp: Modified the round_to_pagesize() so that on
 	  platforms that allow the page size to be obtained dynamically
 	  we'll get that rather than replying on what it set in the
 	  config.h file.  We'll cache this value in a static variable
	  to speedup searches.  Thanks to James Mansion for suggesting
	  this.

	* apps/Gateway/Gateway: Finished adding support for thread-safe
 	  reference counting to the uses of ACE_Message_Block.

	* examples/ASX/Event_Server/Event_Server/Peer_Router.cpp: Replaced
 	  the use of ACE_MT_SYNCH with ACE_SYNCH so that this will compile
 	  correctly on non-MT platforms.

Fri Jan 10 12:38:42 1997  Douglas C. Schmidt  <schmidt@flamenco.cs.wustl.edu>

	* Added a COPYING file that explicitly states the copyright status
 	  of ACE.

	* ace/config-win32-msvc4.x.h and ace/config-winnt-4.0-msvc4.x.h:
 	  By default, we'll revert to *not* enabling
 	  ACE_HAS_TEMPLATE_TYPEDEFS for MSVC++ 4.2, even though this is
 	  well-support by the compiler since it breaks some application
 	  code that expects to use 3 template parameters for
 	  ACE_Svc_Handler<>.  The "fix" is to use the ACE_SOCK_STREAM
 	  macros (rather than using the "ACE_SOCK_Stream, ACE_INET_Addr"
 	  tuple) in order to achieve portability in either case.  Thanks
 	  to Karlheinz for pointing out the need for backwards
 	  compatibility.

Wed Jan  8 01:00:05 1997  Douglas C. Schmidt  <schmidt@tango.cs.wustl.edu>

	* tests/Message_Block_Test.cpp: Enhanced the torture test of the
 	  ACE_Message_Block so that it stresses the reference counting
 	  implementation in a multi-threaded environment.

Wed Jan 08 10:26:45 1997  David L. Levine  <levine@cs.wustl.edu>

	* ace/Message_Block.cpp (~ACE_Data_Block): assigned 0 to
	  allocator_strategry_ after deleting it; fixed template
	  specializations (for g++) by using macros instead of class names;
	  commented out template specializations because Service_Record.cpp
	  already has them, and they should only appear once in the library
	  in order to avoid link clashes

	* ace/Service_Object.cpp (ACE_Service_Object): reordered
	  initializations in constructor

	* ace/Service_Record.cpp (ACE_Service_Record): reordered
	  initializations in constructor

	* ace/config-linux-lxpthreads.h:  added
	  ACE_HAS_RECURSIVE_THR_EXIT_SEMANTICS, thanks to
	  James CE Johnson <jcej@lads.com> for tracking down this
	  problem and testing the fix.

Tue Jan  7 13:03:25 1997  Douglas C. Schmidt  <schmidt@tango.cs.wustl.edu>

	* ace/Message_Block: Continued to improve the
	  ACE_Message_Block/ACE_Data_Block implementation.

	* ace/Message_Block: Added a new constructor to ACE_Message_Block
 	  that takes an ACE_Data_Block * and "owns" it.  Thanks to Tim for
 	  this idea.

	* ace/Log_Msg.cpp: Now that we've prevented signal handlers from
 	  occurring within critical sections of ACE_Log_Msg::log() we
 	  don't need to use the ACE_Recursive_Thread_Mutex anymore.
  	  Instead, we just need ACE_Thread_Mutex.

	* ace/Log_Msg.cpp (log): Added an ACE_Sig_Guard to the block in
 	  ACE_Log_Msg::log() that acquires the mutex that serializes
 	  output.  This prevents nasty problems with recursive to
 	  ACE_Log_Msg::log() from within signal handlers.

	* ace/Service_Config.cpp (end_reactor_event_loop): Added a timeout
 	  of ACE_Time_Value::zero to the ACE_Reactor::notify() method when
 	  called in the ACE_Service_Config::end_reactor_event_loop().
  	  This prevents the Reactor from blocking indefinitely if there's
 	  no longer a thread to receive from the notification pipe.
  
	* netsvcs/clients/Naming/Dump_Restore: Removed the vestigal
 	  nametest.cpp and nametest.h files.  I'm not sure why they were
 	  still there, but they shouldn't have been!

	* ace/Synch.i (remove): this->owner_ should be set to -1 before
 	  calling this->release().  Thanks to Per Andersson
 	  <Per.Andersson@hfera.ericsson.se> for suggesting this.

	* ace/Thread_Manager.cpp (exit): Added a flag called "do_thr_exit"
 	  to the ACE_Thread_Control::exit() method.  This controls whether
 	  we call ACE_OS::thr_exit() after removing the thread from the
 	  Thread Manager's internal table.  This is necessary to work
 	  around pthread bugs on certain platforms (e.g., AIX and Linux).

	* ace/Synch.h: Removed the
 	  ACE_Recursive_Thread_Mutex::set_nesting() method since this
 	  isn't being used and is potentially dangerous.  Thanks to Per
 	  Andersson <Per.Andersson@hfera.ericsson.se> for suggesting this.

	* ace/XtReactor: Updated the XtReactor so that it uses the next
 	  internal Reactor implementation.  Thanks to Mark Rabotnikov
 	  <mark@usp.elscintcorp.co.il> for reporting this.

	* ace/Task.i: Updated the grp_id(int) method to cache the group id
 	  in the task and then set it in the Thread_Manager, if there is
 	  one.  Thanks to Hamutal Yanay <Hamutal_Yanay@mail.icomverse.com>
 	  for suggesting this.

	* ace/Log_Record.h: Updated the ACE_Log_Record class to use the
 	  new ACE_MAXLOGMSGLEN macro.

	* ace/OS.h: Added a new #define called ACE_MAXLOGMSGLEN.  By
 	  default this is 4k.  However, you can reset it in the config.h
 	  file if you'd like to increase or decrease the size.  Thanks to
 	  Anthony McConnell for suggesting this.
	  
	* examples/Threads/tss[12].cpp: Tidied up the tss1.cpp and
 	  tss2.cpp examples and improved the comments.  Thanks to Luca for
 	  suggesting this.

	* ace/Service_Object.cpp (fini): Added the "virtual" keyword to
 	  the new destructor of ACE_Service_Type.  Thanks to David for
 	  reporting this.

	* ace/Message_Block.i: Rearranged the order of the ACE_Data_Block
 	  and ACE_Message_Block locking_strategy() methods so that they'd
 	  be defined as inline before being used.  Thanks to David for
 	  reporting this.

Mon Jan  6 16:46:06 1997  Douglas C. Schmidt  <schmidt@tango.cs.wustl.edu>

	* ace/Service_Manager.cpp (fini): Only try to remove the
 	  ACE_Service_Manager from the Reactor if it's actually been
 	  registered in the first place (i.e., if it's get_handle() method
 	  does not return ACE_INVALID_HANDLE).

	* netsvcs/servers/svc.conf: Changed the name of the net services
 	  .so file from libnet_svcs to netsvcs so that it will work
 	  correctly with our new "cross-platform" svc.conf ACE::ldfind()
 	  strategy.  Thanks to Marius Kjeldahl <marius@funcom.com> for
 	  reporting this.

	* ace/Reactor.cpp (find): Added a strategic break and a check for
 	  handle_in_range().  Thanks to Tim for this help!

	* netsvcs/clients/Naming/Client/svc.conf: Removed the "lib" part
 	  from the executable shared object file names in the svc.conf
 	  file so that it will work with the new "cross-platform" svc.conf
 	  ACE::ldfind() strategy.  Thanks to Marius Kjeldahl
 	  <marius@funcom.com> for reporting this.

	* ace/Service_Record.cpp (fini): Added an extra assignment to a
 	  temporary const void *obj to avoid problems with MSVC++ and it's
 	  cast mechanism.

	* ace/ReactorEx.h: Added a default parameter to
 	  ACE_ReactorEx::notify().  Thanks to Tim for noticing this.

Sun Jan  5 10:48:23 1997  Douglas C. Schmidt  <schmidt@tango.cs.wustl.edu>

	* tests: Added a new test for ACE_Message_Block, which is called
 	  Message_Block_Test.cpp (no surprise there ;-)).  This test
 	  exercises the reference counting mechanisms.

	* ace/Message_Block.h: Made the destructors for ACE_Message_Block
 	  and ACE_Data_Block virtual, so that these classes can be
 	  subclassed and ACE_Message_Blocks can delete these
	  subclasses (either via release() or delete).  Thanks to Tilo
	  Christ for suggesting this.

	* ace/Message_Block.cpp: Modified the implementation
	  of ACE_Message_Block/ACE_Data_Block so that we always create
	  an allocator_strategy_.  By default, this strategy will be
	  ACE_Allocator_Adapter <ACE_Malloc <ACE_Local_Memory_Pool, ACE_Null_Mutex> >;
	  This greatly simplifies the code.

	* ace/Message_Block.h: It's now possible to assign a
 	  Message_Block's priority when you create it.

	* ace/Reactor: Sped things up some more by merging the Reactor's
 	  any_ready() and fill_in_ready() methods together.  This reduces
 	  redundant computations.

	* ace/Reactor: Changed the name of ACE_Reactor::detach() to
 	  ACE_Reactor::remove_handler_i() and changed the name of
 	  ACE_Reactor::attach() to ACE_Reactor::register_handler_i().
  	  This is more consistent with the other naming schemes.

	* ace/Reactor.cpp: Reworked the implementation of the Handler
 	  Repository's unbind() method in order to simplfy the logic.
  	  Also merged in all the Reactor's detach() functionality into the
 	  unbind() method in order to localize all the handler removal
 	  processing.

	* ace/Reactor[Ex].cpp: Added more descriptive errno entries for
 	  failed operations in the handler repository.

	* ace/Reactor.cpp: Modified the implementation of the Handler
 	  Repository's bind() method so that it reports an error if you
 	  try to register an Event_Handler for an invalid HANDLE.

	* ace/Reactor.cpp: Reimplemented the internals of the Reactor to
 	  prepare for the upcoming merge of the Reactor and ReactorEx to
 	  use a single code base.

	* ace/Timer_Queue.cpp: Modified the behavior of the expire()
 	  methods so that they return the number of ACE_Event_Handlers
 	  whose handle_timeout() method was called.

Sat Jan  4 11:47:05 1997  Douglas C. Schmidt  <schmidt@tango.cs.wustl.edu>

	* ace/Reactor.h: Removed the #ifdefs for ACE_HAS_POLL.  This will
 	  be recast as a strategy in subsequent implementations.

	* ace/Reactor.cpp: Added a new call,
 	  ACE_Handler_Repository::handle_in_range(), which checks to make
 	  sure that the HANDLE is within the range of 0 .. max_handlep1_.
  	  This factors out some redundant code.

	* ace/Reactor.cpp: Sped up the performance of the Reactor by
 	  removing redundant calls to
 	  ACE_Handler_Repository::invalid_handle() and
 	  ACE_Handler_Repository::find().

	* tests/Reactors_Test.cpp: Added a test for
 	  the new Reactor::notify() method with timeouts.

	* examples/Reactor/Misc/notification.cpp (svc): Added a test for
 	  the new Reactor::notify() method with timeouts.

	* ace/Reactor[Ex]: Modified the Reactor and ReactorEx so that they
 	  use timed send() operations for their notify() methods.  This
 	  makes it possible for users to bound the amount of time they're
 	  willing to wait to try and notify the Reactor.  This is mostly
 	  useful to avoid infinite blocking if there is congestion in the
 	  Reactor's notification mechanism.

	* ace/ACE.cpp: Added a new timed send() method that uses the
 	  write() system call on UNIX and the socket send() call on Win32.
  	  This new method is used in the new ACE_Reactor::notify() method,
 	  which now supported timed notifications.

	* ace/Reactor.cpp (ACE_Handler_Repository): To simplify the code
 	  and reduce unnecessary #ifdefs, I've merged the max_handlep1_
 	  and cur_size_ fields (which are now called max_handlep1_).

Fri Jan  3 10:47:15 1997  Douglas C. Schmidt  <schmidt@tango.cs.wustl.edu>

	* ace: Replaced all uses of "delete mb" with mb->release ();

	* ace/Stream_Modules.cpp: Replaced the use of explicit bit
	  twiddling with the ACE_BIT* macros.

	* ace/Message_Block.cpp: Make sure that we use the
 	  allocator_strategy_ to create the memory for the reference count
 	  since this may need to go into shared memory if that's the
 	  memory pool where the Message_Block allocations are coming from.

	* ace/OS.h: Added two new macros, ACE_ALLOCATOR_RETURN and
	  ACE_ALLOCATOR, which are similar to ACE_NEW_RETURN and ACE_NEW, 
	  except that these

	* ace/Message_Block.cpp (release): Make sure to "delete this"
 	  outside the scope of the locking_strategy_.

	* ace/Service_Object.cpp: Added a destructor to ACE_Service_Type.
  	  Thanks to Per.Andersson@hfera.ericsson.se (Per Andersson) for
 	  suggesting this.

	* ace/Service_Object.i: Be smarter about how we reassign the name_
 	  pointer, i.e., delete the old one and make a copy.  Thanks to
 	  Per.Andersson@hfera.ericsson.se (Per Andersson) for reporting
 	  this.

	* ace/Module.cpp (open): Rearranged the assignments to
 	  reader_q->mod_ and writer_q->mod_ so that we don't try to
 	  initialize through NULL pointers.  Thanks to
 	  Per.Andersson@hfera.ericsson.se (Per Andersson) for reporting
 	  this.

	* ace/Service_Record.cpp (ACE_Service_Record): Initialized name_
 	  to NULL so that the following change works correctly now.
  	  Thanks to Per.Andersson@hfera.ericsson.se (Per Andersson) for
 	  reporting this.

	* ace/Service_Record.i (name): Make sure to delete [] (char *)
 	  this->name_ before allocating a new one.  Thanks to
 	  Per.Andersson@hfera.ericsson.se (Per Andersson) for reporting
 	  this.

	* ace/Message_Block: Reworked the reference counting implemention
 	  so that reference counts are shared correctly amongst their
 	  various owners.  This requires making a deep copy the "header"
 	  portion, but a shallow copy of the "data."

	* ace/Message_Block.cpp (ACE_Message_Block): Updated all three
 	  ACE_Message_Block constructors so that they all call the init()
 	  method.  This centralizes all the initialization logic in one
 	  place.

Thu Jan  2 00:42:21 1997  Douglas C. Schmidt  <schmidt@tango.cs.wustl.edu>

	* ace/Message_Block.cpp (ACE_Message_Block): Make sure to set the
 	  cont_ field to 0 after "releasing" it so that we don't
 	  mistakenly think it's still around later on.  This problem arose
 	  in the ACE_Message_Queue::close() method, which was trying to
 	  count the number of bytes being freed.

	* ace/Message_Queue.cpp (close): Fixed a subtle bug where we
 	  weren't actually deleting messages from the
 	  ACE_Message_Queue::close() routine.  This should work now...

	* ace/Message_Queue.cpp (close): Replaced the use of "delete mb"
 	  with "mb->release()" since the Message_Blocks are now reference
 	  counted.  

	* ace/Message_Block: Enhanced the reference counting scheme so
 	  that you can increment and decrement the count by an arbitrary
 	  amount.  This is particular useful when you know you'll be
 	  sending the same Message_Block to N consumers.

	* ace/Singleton: The dump() must be used same as instance()
          (without supplying an object) so it must be declarated *static*,
	  i.e.,

	  static void dump (void);

	  Thanks to Sandro Doro <alex@aureus.sublink.org> for reporting
 	  this.

	* examples/ASX/Event_Server: Completely rewrote and retested the
 	  ACE Event Server example.  The new code is *much* easier to
 	  understand, has many more comments, is more robust, and compiles
 	  much faster since I removed many of the templates.

	* examples/ASX/Event_Server/Tranceiver/tranceiver.cpp: Fixed the
 	  tranceiver so that it shuts down correctly when the Event_Server
 	  exits.

	* examples/Connection/non_blocking/CPP-connector.cpp: Fixed a
 	  problem where we were trying to select() on ACE_STDIN on Win32.
  	  Naturally, this doesn't work, so we used the
 	  ACE::register_stdin_handler() to fix this.  Thanks to
 	  Samuel_Bercovici <Samuel_Bercovici_at_EFT__AD2@mail.icomverse.com>
	  for reporting this.

	* examples/ASX/Event_Server/Event_Server/Options: Changed the
 	  Options class to be a Singleton...

	* ace/Task.h: Added "const" method qualifier to accessor methods
 	  like is_reader() and is_writer().

Wed Jan  1 00:10:47 1997  Douglas C. Schmidt  <schmidt@tango.cs.wustl.edu>

	* ace/Message_Block: Added a new static release() method that
 	  behaves like the non-static method release(), except that it
 	  checks if <mb> is 0.  This is similar to CORBA::release(), which
 	  is useful if you want to eliminate lots of checks for NULL
 	  pointers before calling release() on them.

	* Updated all places in ACE where we use
 	  ACE_Event_Handler::READ_MASK when we should be using
 	  ACE_Event_Handler::ACCEPT_MASK.

	* examples/Service_Configurator/IPC-tests/server/Handle_Thr_Stream.cpp:
 	  Changed the name of the acceptor class from Handle_Thr_Stream to
 	  Handle_Thr_Acceptor, which is more accurate.

	* ace/Reactor: Since we've now got an
 	  ACE_Event_Handler::ACCEPT_MASK (intended primarily to accept
 	  connections asynchronously using Win32 overlapped I/O) we can
 	  now use this with the ACE_Reactor, as well.  In particular, any
 	  time that we are registering a "passive-mode" socket acceptor we
 	  can now specify ACE_Event_Handler::ACCEPT_MASK.  This is much
 	  more intuitive than using the READ_MASK (which never made any
 	  sense...).  The ACE_Reactor now treats the ACCEPT_MASK as a
 	  READ_MASK internally, so you can still use READ_MASK if you'd
 	  like (i.e., this change doesn't break any existing code).

	* ace/Event_Handler: Changed "get_priority" and "set_priority" to
 	  simply "priority(void)" and "priority(int)" to be more
 	  consistent with other parts of ACE.

	* apps/Gateway/Gateway: Updated the Gateway so that the
	  concurrency strategies can now be specified on the
	  command-line (or in the svc.conf file), rather than being
	  determined at compile-time.  This is much more flexible.
	  See the ./apps/Gateway/Gateway/README file for details.

	* apps/Gateway/Gateway: Verified that all the multi-threading
 	  strategies still work.

	* ace/Message_Block.cpp (ACE_Message_Block): Make sure that we
 	  "release" the continuation field, rather than delete it, since
 	  its reference count may be > 1.

	* ace/Log_Msg.cpp (log): Change the abort_prog logic a bit so that
 	  we always print a message to stderr if we're exiting,
 	  regardless...  Thanks to David Levine for pointing this out.

	* apps/Gateway/Gateway: Moved all of the configuration file
 	  parsing logic *outside* of the Event_Channel into the Gateway
 	  class so that we wouldn't have unnecessary dependencies.

	* apps/Gateway/Gateway: Redesigned the Gateway so that the
 	  Proxy_Handlers (i.e., the Consumer_Proxy and Supplier_Proxy)
 	  most of their work to the Event_Channel.  This "lightweight
 	  proxy" design is an improvement since it is now possible to
 	  emulate the COS Event Channel semantics within the Event_Channel
 	  "kernel."

	* Happy new year!  Let's start a new ChangeLog to celebrate the
	  new year.


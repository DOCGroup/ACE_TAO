#!/bin/sh

PORT=20000
IORFILE=theior
start_server()
{
  ./server -ORBport $PORT -o $IORFILE &
}

# Restart the server if we get SIGCHLD, i.e., the server died.
trap "start_server" 17
trap "rm -f $IORFILE" 0
start_server

TYPES="short ubstring fixed_struct var_struct nested_struct struct_seq objref"
for type in $TYPES
do
  echo "BEGIN Testing type $type"
  sleep 1	# Give the server a chance to start up
  ./client -f `cat $IORFILE` -t $type
  echo "END   Testing type $type"
done 

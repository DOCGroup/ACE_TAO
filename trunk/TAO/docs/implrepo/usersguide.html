<html>
<!-- $Id$ -->

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>Implementation Repository User's Guide</title>
</head>

<body bgcolor="#FFFFFF">

<hr>

<h3>Implementation Repository User's Guide</h3>

<p>In order for a server to make use of the Implementation Repository, it must communicate
with the IMR to keep it up to date on such things as the server's running status. These 
functions now are contained within the POA, so when a Persistent POA is used on a server
that has -ORBUseIMR specified, it will communicate with an Implementation Repository, if
one is available.</p>

<hr>

<h4>How is the IMR used?</h4>

<p>The main steps for the lifetime of a server that uses the IMR are generally the
following:

<ol>
  <li>Register name and startup commands with the IMR using <b>tao_imr<br>
    </b><em>Example:<code>  </code> </em><code> tao_imr -ORBInitRef ImplRepoService=file://implrepo.ior add plane -c
    &quot;airplane_server -i -ORBInitRef ImplRepoService=file://implrepo.ior&quot;<br>
    <br>
    </code>Note that the name used to register the server is the name of the POA
    which the objects are created in. So in this example, the
    airplane_server creates a POA called &quot;plane&quot; and activates its
    servants under it.<code> <br>
    </code></li>
  <li>Start the server once to generate an IMR-ified IOR<br>
  </li>
  <li>Start clients and pass them the above IOR<br>
  </li>
  <li>Clients will use the IOR, which will automatically go through the IMR<br>
  </li>
  <li>The IMR will start the server if it is not already running<br>
  </li>
  <li>At any time when the server is not currently in use by a client, it can be shut down
    using <strong>tao_imr<br>
    </strong><em>Example:</em><code> tao_imr -ORBInitRef ImplRepoService=file://implrepo.ior shutdown
    plane<br>
    </code></li>
  <li>After the server isn't needed anymore, it can be removed from the IMR database using <strong>tao_imr<br>
    </strong><em>Example:<code> </em>tao_imr -ORBInitRef ImplRepoService=file://implrepo.ior remove plane</code></li>
</ol>

<hr>

<h4>So what does the server need to do? </h4>

<p>As of TAO 1.0.9, the Implementation Repository support on the server-side has
been integrated into the POA. Previously, the IR_Helper class needed to be
used explicitly. Now only the &quot;-ORBUseImplRepo 1&quot; command line
argument needs to be used. </p>

<p>There are a couple of restrictions on the server though. Only objects
within a persistent POA will be supported by the IMR. Also the
Implementation repository will key its entries on POA name. What this
means for the server is that each server must have unique persistent POA names. </p>

<hr>

<h4>What are activation modes</h4>

<p>Each server can have one of three different types of activation modes:</p>
<ul>
  <li>NORMAL is the default.  The server can be started via tao_imr, the command line, and
      with client requests. </li>
  <li>MANUAL specifies that the server shouldn't be  activated with a client request but can 
      be activated through tao_imr or via the command line.  </li>
  <li>PER_CLIENT specifies that each request to the ImplRepo will result in a new server 
      process started up.  Because clients cache the forwarded reference, there is one server 
	  per client (more or less).  There are some exceptions, such as if the original IOR
	  is used in different threads (each thread would get a different server).  <b>Note:</b>
	  The Implementation Repository doesn't store any information about the started servers
	  in this mode, so it cannot be used to shut down the servers.  So the servers must 
	  have an alternative way of shutting down. </li>
  <li>AUTO_START specifies that a server should be activated when the Implementation Repository
      is started.  tao_imr also has an autostart command to activate all servers marked 
	  AUTO_START</li>
</ul>

<hr>

<p>Last update to this document: $Date$</p>

<p>Back to <a href="index.html">Implementation Repository</a></p>
</body>
</html>

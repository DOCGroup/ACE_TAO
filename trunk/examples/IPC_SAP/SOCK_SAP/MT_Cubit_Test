#! /bin/sh
# $Id$
#
# Spawns MT_Cubit server and client executables on a single host.

usage="usage: $0 [-n <iterations>] [-t] [-l] <# low priority threads>"
usage2="    [-t] uses /tmp, [-l] suppresses use of -ORBiioplite"

user=`whoami`
iterations=1000

########
######## Interpret command arguments.
########
while getopts ?ln:t arg; do
  case $arg in
      l   ) iiop_lite= ;;
      n   ) iterations=$OPTARG ;;
      t   ) tmp='/tmp/' ;;
      '?' ) echo $usage; echo $usage2; exit 0 ;;
  esac
done
shift `expr $OPTIND - 1`

if [ $# -ne 1 ]; then
  echo $usage; echo $usage2
  exit 1
fi
threads=$1;


########
######## Enable signal handler.
########
trap 'kill -1 $server_pid; ' 0 1 2 15


########
######## Start server and save its pid.
########
./CPP-inserver-fancy > \
  ${tmp}server.log 2>&1 &
server_pid=$!

sleep 2;

########
######## Start client.
########
./CPP-inclient -2 -T 100000 -m 69 -t $threads -i 100  > ${tmp}client-${threads}.log 2>&1

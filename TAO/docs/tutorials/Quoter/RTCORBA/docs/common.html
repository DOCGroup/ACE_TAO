<!-- $Id$ -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Common implementation for the Stock Quoter Publisher/Subscriber Real-time CORBA Service</title>
</head>

<body
 text = "#000000"
 link = "#000fff"
 vLink= "#ff0f0f"
 aLink = "#0000ff"
 bgColor = "#ffffff">

<hr><h2>Common implementation for the Stock Quoter Publisher/Subscriber Real-time CORBA Service</h2><hr>

<h3>Implementation of StockNameConsumer interface</h3>

This interface is used as a callback interface used by the Stock Distributor server to
notify Stock Broker clients of updates. <P>
The Stock_StockNameConsumer_i class is generated automatically by the IDL compiler (using the -GI flag),
which is a subclass of POA_Stock::StockNameConsumer class. <P>

<h4>Implementing the Constructor</h4>

<PRE>
    Stock_StockNameConsumer_i (Stock::StockBroker_ptr parent, const char *stock_name)
      : parent_ (Stock::StockBroker::_duplicate (parent)),
        stock_name_ (CORBA::string_dup (stock_name))
</PRE>

The "parent_" and "stock_name_" are two private members of the Stock_StockNameConsumer_i class. They stand for the
parent broker of the StockNameConsumer object and the name of the stock to listen to respectively. <P>

<h4>Implementing the push_StockName () member function</h4>

The main steps of this function are described as follows: <P>

<li>Verify the "parent_" private member is valid.</li> <P>

<li>Verify this is the correct stock: Check if the StockName parameter in this function is equal to
the "stock_name_" private member. If this is not the stock that we are interested in then we need to stop
and return.</li> <P>

<li>Get the quoter for the connection.</li>

<PRE>
    Stock::StockQuoter_var quoter = parent_->get_connection_quoter_info ();
</PRE>

<li>Request more information from the quoter.</li>

<PRE>
    Stock::StockInfo_var stock_info = quoter->get_stock_info (the_stockname->name());
</PRE>

<hr><h3>Implementation of StockQuoter interface</h3>

This interface is used by brokers to get detailed stock information. <P>
The Stock_StockQuoter_i class is generated automatically by the IDL compiler (using the -GI flag),
which is a subclass of POA_Stock::StockQuoter class. <P>

<h4>Implementing the get_stock_info () member function</h4>

<PRE>
    Stock_Database::instance ()->lock ();
    Stock::StockInfo * stock = Stock_Database::instance ()->get_stock_info (stock_name);
    Stock_Database::instance ()->unlock ();
</PRE>

Call the get_stock_info () function of Stock_Database interface.

<hr><b>Email: </b><a href="mailto:"</a<ADDRESS>shanshan.jiang@vanderbilt.edu</ADDRESS>

</body>

</html>

--- orig/MessagingS.h	Tue Apr  3 22:01:25 2001
+++ patched/MessagingS.h	Tue Apr  3 22:12:04 2001
@@ -23,11 +23,13 @@
 #define _TAO_IDL_ORIG_MESSAGINGS_H_
 
 #include "ace/pre.h"
-#include "TimeBaseS.h"
-#include "IOPS.h"
-#include "PolicyS.h"
-#include "PollableS.h"
-#include "MessagingC.h"
+
+#include "tao/orbconf.h"
+
+#if (TAO_HAS_CORBA_MESSAGING == 1)
+
+#include "tao/TimeBaseS.h"
+#include "tao/MessagingC.h"
 
 
 #if !defined (ACE_LACKS_PRAGMA_ONCE)
@@ -52,6 +54,9 @@
 
 TAO_NAMESPACE  POA_Messaging
 {
+
+#if (TAO_HAS_AMI_CALLBACK == 1)
+
   class ReplyHandler;
   typedef ReplyHandler *ReplyHandler_ptr;
   // Forward Classes Declaration
@@ -59,7 +64,7 @@
   class _TAO_ReplyHandler_Direct_Proxy_Impl;
   class _TAO_ReplyHandler_Strategized_Proxy_Broker;
   
-  class TAO_Export ReplyHandler :  public virtual PortableServer::ServantBase
+  class TAO_PortableServer_Export ReplyHandler :  public virtual PortableServer::ServantBase
   {
   protected:
     ReplyHandler (void);
@@ -125,7 +130,7 @@
   //               Strategized Proxy Broker Declaration 
   //
   
-  class TAO_Export _TAO_ReplyHandler_Strategized_Proxy_Broker : public virtual ::Messaging::_TAO_ReplyHandler_Proxy_Broker
+  class TAO_PortableServer_Export _TAO_ReplyHandler_Strategized_Proxy_Broker : public virtual ::Messaging::_TAO_ReplyHandler_Proxy_Broker
   {
   public: 
     _TAO_ReplyHandler_Strategized_Proxy_Broker (void);
@@ -173,7 +178,7 @@
 //                    ThruPOA  Impl. Declaration
 //
 
-class TAO_Export _TAO_ReplyHandler_ThruPOA_Proxy_Impl : 
+class TAO_PortableServer_Export _TAO_ReplyHandler_ThruPOA_Proxy_Impl :
   public virtual ::Messaging::_TAO_ReplyHandler_Proxy_Impl,
   public virtual TAO_ThruPOA_Object_Proxy_Impl
 {
@@ -194,7 +199,7 @@
 //                    Direct  Impl. Declaration
 //
 
-class TAO_Export _TAO_ReplyHandler_Direct_Proxy_Impl : 
+class TAO_PortableServer_Export _TAO_ReplyHandler_Direct_Proxy_Impl :
   public virtual Messaging::_TAO_ReplyHandler_Proxy_Impl,
   public virtual TAO_Direct_Object_Proxy_Impl
 {
@@ -214,7 +219,7 @@
 #if defined (ACE_HAS_USING_KEYWORD)
 // TIE class: Refer to CORBA v2.2, Section 20.34.4
 template <class T>
-class TAO_Export ReplyHandler_tie : public ReplyHandler
+class TAO_PortableServer_Export ReplyHandler_tie : public ReplyHandler
 {
 public:
   ReplyHandler_tie (T &t);
@@ -257,6 +262,8 @@
 
 #endif /* ACE_HAS_USING_KEYWORD */
 
+#endif /* TAO_HAS_AMI_CALLBACK == 1 */
+
 }
 TAO_NAMESPACE_CLOSE
 
@@ -273,6 +280,8 @@
 #if defined (__BORLANDC__)
 #pragma option pop
 #endif /* __BORLANDC__ */
+
+#endif /* TAO_HAS_CORBA_MESSAGING == 1 */
 
 #include "ace/post.h"
 #endif /* ifndef */
